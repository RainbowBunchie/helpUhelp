<section class="tasks-page">
  <div class="tasks-container">
    <p id="notice"><%= notice %></p>

    <% if current_user && current_user.role.title == "admin" %>
    <div class ="new-task">
      <%= link_to 'Neue Aufgabe erstellen', new_task_path %>
    </div>
    <% end %>

    <% if current_user && current_user.role.title == "admin" %>

      <h1>This part can only be viewed by user. Delete this h1 later... just for orientation purposes</h1>

      <%# Users can view their assigned tasks here%>
      <h1>Meine bestätigten Aufgaben</h1>
      <% if @assigned_usertasks.size > 0 %>
      <div class="tasks">
      <% @assigned_usertasks.each do |task| %>
        <div class="task-card assigned">
          <div class="info">
            <%= link_to task do%>
              <div class="task-description"><%= task.description%></div>
              <div class="task-info">
                <strong>Datum: </strong><%= task.date.strftime("%d.%m.%y") %> <br />
                <strong>Beginn: </strong>  <%= task.time.strftime("%H:%M")%> <br />
                <strong>Ort: </strong><%= task.place %>
              </div>
            <% end %>
          </div>
          <div class ="admin-options">
            <%= link_to 'absagen', remove_user_task_path(task), method: :post %>
          </div>
        </div>
      <% end %>
      </div>
      <% else %>
        Du hast keine zugewiesenen Aufgaben.
      <% end %>


      <%# Users can view their pending tasks here%>
      <h1>Meine beworbenen Aufgaben</h1>
      <% if @pending_usertasks.size > 0 %>
      Es muss noch auf die Bestätigung des Managers gewartet werden.
      <div class="tasks">
      <% @pending_usertasks.each do |task| %>
        <div class="task-card pending">

          <div class="info">
            <%= link_to task do%>
              <div class="task-description"><%= task.description%></div>
              <div class="task-info">
                <strong>Datum: </strong><%= task.date.strftime("%d.%m.%y") %> <br />
                <strong>Beginn: </strong>  <%= task.time.strftime("%H:%M")%> <br />
                <strong>Ort: </strong><%= task.place %>
              </div>
            <% end %>
          </div>
          <div class ="admin-options">
            <%= link_to 'absagen', remove_user_task_path(task), method: :post %>
          </div>
        </div>
      <% end %>
      </div>
      <% else %>
        Du hast keine beworbenen Aufgaben. Bewirb dich doch für eine Aufgabe.
      <% end %>


      <%# Users can view unassigned tasks here and can apply for them %>
      <h1>Unzugewiesene Aufgaben</h1>
      <div class="tasks">
        <% @tasks.each do |task| %>
          <% if !task.assigned %>
            <div class="task-card unassigned">
              <div class="info">
                <div class="task-description"><%= task.description%></div>
                <%= link_to task do%>
                  <div class="task-info">
                    <strong>Datum: </strong><%= task.date.strftime("%d.%m.%y") %> <br />
                    <strong>Beginn: </strong>  <%= task.time.strftime("%H:%M")%> <br />
                    <strong>Ort: </strong><%= task.place %>
                  </div>
                <% end %>
              </div>
              <div class ="admin-options">
                <%= link_to 'bewerben', add_user_task_path(task), method: :post %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>


    <h1>This part can only be viewed by admin. Delete this h1 later... just for orientation purposes</h1>
    <%# Only admin can view all the Tasks and Tasks should be colored for him %>
    <% if current_user && current_user.role.title == "admin" %>

    <%# Pending Tasks On The Top %>
    <h1>Aufgaben mit Bewerbern</h1>


    <%# Unassigned tasks in the middle %>
    <h1>Unzugewiesene Aufgaben</h1>
    <div class="tasks">
      <% @unassigned_tasks.each do |task| %>
        <div class="task-card unassigned">
          <div class="info">
            <div class ="admin-options task-option">
              <%= link_to image_tag('edit-pen.png', size: "50x51", alt: "Aufgaben", class: 'd-inline-block'), edit_task_path(task) %>
              <%= link_to link_to image_tag('delete.png', size: "50x51", alt: "Aufgaben", class: 'd-inline-block'), task, method: :delete, data: { confirm: 'Are you sure?' } %>
            </div>

            <div class="task-description"><%= task.description%></div>
            <%= link_to task do%>
              <div class="task-info">
                <strong>Datum: </strong><%= task.date.strftime("%d.%m.%y") %> <br />
                <strong>Beginn: </strong>  <%= task.time.strftime("%H:%M")%> <br />
                <strong>Ort: </strong><%= task.place %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <%# Already Assigned tasks on the bottom %>

    <h1>Zugewiesene Aufgaben</h1>
    <div class="tasks">
      <% @assigned_tasks.each do |task| %>
        <div class="task-card assigned">
          <div class="info">
            <div class ="admin-options task-option">
              <%= link_to image_tag('edit-pen.png', size: "50x51", alt: "Aufgaben", class: 'd-inline-block'), edit_task_path(task) %>
              <%= link_to link_to image_tag('delete.png', size: "50x51", alt: "Aufgaben", class: 'd-inline-block'), task, method: :delete, data: { confirm: 'Are you sure?' } %>
            </div>

            <div class="task-description"><%= task.description%></div>
            <%= link_to task do%>
            <div class="task-info">
              <strong>Datum: </strong><%= task.date.strftime("%d.%m.%y") %> <br />
              <strong>Beginn: </strong>  <%= task.time.strftime("%H:%M")%> <br />
              <strong>Ort: </strong><%= task.place %>
            </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>



    <% end %>
  </div>
</section>